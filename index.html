
<import React, { useState } from "react";

export default function EncuestaCesar() {
  const [answers, setAnswers] = useState({ q1: "", q2: "", q3: "", q4: "", q5: "" });
  const [errorQ1, setErrorQ1] = useState("");
  const [showCipher, setShowCipher] = useState(false);
  const [decoded, setDecoded] = useState("");
  const [accessGranted, setAccessGranted] = useState(false);

  const correctYear = "1957";
  const cipherText = "Wkh dxwru gh hvwh uhwr hv 7x 1rpeuh"; // Ejemplo cifrado César con desplazamiento 3

  function caesarDecrypt(text, shift) {
    const a = "A".charCodeAt(0), z = "Z".charCodeAt(0);
    const A = "a".charCodeAt(0), Z = "z".charCodeAt(0);
    const s = ((shift % 26) + 26) % 26;
    let res = "";
    for (let ch of text) {
      const code = ch.charCodeAt(0);
      if (code >= A && code <= Z) {
        res += String.fromCharCode(((code - A - s + 26) % 26) + A);
      } else if (code >= a && code <= z) {
        res += String.fromCharCode(((code - a - s + 26) % 26) + a);
      } else {
        res += ch;
      }
    }
    return res;
  }

  const handleSubmit = (e) => {
    e.preventDefault();
    if (answers.q1 !== correctYear) {
      setErrorQ1("El colegio inicia labores en el año 1957, en un terreno donado por el señor Escolástico Rojas. No se tiene certeza del porqué del nombre, al parecer se adopta por el sector donde se encuentra ubicado, barrio Soledad Norte, o por acepción religiosa. Inicia labores con cuatro cursos de primaria y posteriormente se amplía a la primaria completa.");
      return;
    }
    setErrorQ1("");
    setShowCipher(true);
  };

  const handleDecode = () => {
    if (decoded.trim() === caesarDecrypt(cipherText, 3).trim()) {
      setAccessGranted(true);
    } else {
      alert("Código incorrecto. Intenta de nuevo.");
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6">
      <div className="max-w-3xl mx-auto bg-white rounded-2xl shadow-lg p-6">
        <h1 className="text-2xl font-bold mb-4">Reto del Colegio — Cifrado César</h1>
        <p className="mb-6 text-sm text-slate-700">El cifrado César es una técnica que sustituye cada letra por otra desplazada un número fijo de posiciones en el alfabeto. Por ejemplo, con desplazamiento 3, A → D, B → E, etc. Tu misión es responder las siguientes preguntas y luego descifrar el código final.</p>

        {!showCipher && (
          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label>1. ¿En qué año fue fundado nuestro colegio?</label>
              <select value={answers.q1} onChange={(e) => setAnswers({ ...answers, q1: e.target.value })} className="block w-full mt-1 p-2 border rounded">
                <option value="">Selecciona...</option>
                <option value="1950">1950</option>
                <option value="1957">1957</option>
                <option value="1975">1975</option>
                <option value="2005">2005</option>
              </select>
              {errorQ1 && <p className="mt-2 text-red-600 text-sm">{errorQ1}</p>}
            </div>

            <div>
              <label>2. ¿Cuál es el color principal del uniforme escolar?</label>
              <select value={answers.q2} onChange={(e) => setAnswers({ ...answers, q2: e.target.value })} className="block w-full mt-1 p-2 border rounded">
                <option value="">Selecciona...</option>
                <option>Azul</option>
                <option>Verde</option>
                <option>Rojo</option>
                <option>Gris</option>
              </select>
            </div>

            <div>
              <label>3. ¿Cuál es la mejor materia del colegio?</label>
              <input type="text" value={answers.q3} onChange={(e) => setAnswers({ ...answers, q3: e.target.value })} className="block w-full mt-1 p-2 border rounded" />
            </div>

            <div>
              <label>4. ¿En qué ciudad se encuentra nuestra sede principal?</label>
              <input type="text" value={answers.q4} onChange={(e) => setAnswers({ ...answers, q4: e.target.value })} className="block w-full mt-1 p-2 border rounded" />
            </div>

            <div>
              <label>5. ¿Te gusta el colegio?</label>
              <select value={answers.q5} onChange={(e) => setAnswers({ ...answers, q5: e.target.value })} className="block w-full mt-1 p-2 border rounded">
                <option value="">Selecciona...</option>
                <option>Sí</option>
                <option>No</option>
                <option>A veces</option>
              </select>
            </div>

            <button type="submit" className="px-4 py-2 bg-indigo-600 text-white rounded">Enviar respuestas</button>
          </form>
        )}

        {showCipher && !accessGranted && (
          <div className="mt-6">
            <h2 className="font-semibold mb-2">Decifra el siguiente código:</h2>
            <p className="mb-4 font-mono bg-slate-100 p-3 rounded">{cipherText}</p>
            <input type="text" value={decoded} onChange={(e) => setDecoded(e.target.value)} placeholder="Escribe el texto descifrado" className="block w-full p-2 border rounded mb-3" />
            <button onClick={handleDecode} className="px-4 py-2 bg-green-600 text-white rounded">Verificar</button>
          </div>
        )}

        {accessGranted && (
          <div className="mt-6 p-4 bg-green-50 border border-green-200 rounded">
            <h2 className="text-lg font-bold mb-2">Datos personales</h2>
            <p><strong>Nombre:</strong> Juan Pérez</p>
            <p><strong>Correo:</strong> juanperez@example.com</p>
            <p><strong>Teléfono:</strong> +57 300 123 4567</p>
            <p><strong>Dirección:</strong> Calle Falsa 123, Bogotá</p>
          </div>
        )}
      </div>
    </div>
  );
}
